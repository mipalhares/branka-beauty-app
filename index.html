<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Branka Beauty PWA</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#f472b6">
  <link rel="icon" href="/favicon.ico">
  <script>
    // Register service worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => console.log('Service Worker registered'))
          .catch(err => console.log('Service Worker registration failed:', err));
      });
    }
  </script>
</head>
<body class="bg-gray-100 font-sans">
  <!-- Navbar -->
  <nav class="bg-pink-600 text-white p-4 shadow-md">
    <div class="container mx-auto flex justify-between items-center">
      <h1 class="text-xl font-bold">Branka Beauty</h1>
      <div>
        <button id="cartBtn" class="relative">
          🛒 <span id="cartCount" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full px-2 text-xs">0</span>
        </button>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container mx-auto p-4">
    <!-- Product List -->
    <div id="productList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>

    <!-- Cart Modal -->
    <div id="cartModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center">
      <div class="bg-white p-6 rounded-lg w-full max-w-md">
        <h2 class="text-lg font-bold mb-4">Carrinho</h2>
        <div id="cartItems"></div>
        <p class="font-bold mt-4">Total: R$ <span id="cartTotal">0,00</span></p>
        <button id="checkoutBtn" class="bg-pink-600 text-white px-4 py-2 rounded mt-4 w-full">Finalizar Compra</button>
        <button id="closeModal" class="bg-gray-300 px-4 py-2 rounded mt-2 w-full">Fechar</button>
      </div>
    </div>
  </div>

  <script>
    // Mock product data (based on Branka Beauty products)
    const products = [
      { id: 1, name: "Esponja Flat Blend - Oceane", price: 39.90, stock: 9, image: "https://via.placeholder.com/150?text=Esponja" },
      { id: 2, name: "Máscara de cílios Big Panda - Vizzela", price: 49.90, stock: 1, image: "https://via.placeholder.com/150?text=Mascara" },
      { id: 3, name: "Lapiseira Retrátil - Bruna Tavares", price: 59.90, stock: 5, image: "https://via.placeholder.com/150?text=Lapiseira" },
      { id: 4, name: "Paleta Blush - Dalla", price: 34.90, stock: 4, image: "https://via.placeholder.com/150?text=Paleta" },
    ];

    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    // Render products
    const productList = document.getElementById('productList');
    products.forEach(product => {
      const stockAlert = product.stock <= 5 ? `<p class="text-red-500 text-sm">Atenção, só restam ${product.stock} em estoque!</p>` : '';
      productList.innerHTML += `
        <div class="bg-white p-4 rounded-lg shadow-md">
          <img src="${product.image}" alt="${product.name}" class="w-full h-40 object-cover rounded">
          <h3 class="text-lg font-semibold mt-2">${product.name}</h3>
          <p class="text-gray-600">R$ ${product.price.toFixed(2).replace('.', ',')}</p>
          ${stockAlert}
          <button onclick="addToCart(${product.id})" class="bg-pink-600 text-white px-4 py-2 rounded mt-2 w-full">Adicionar ao Carrinho</button>
        </div>
      `;
    });

    // Add to cart
    function addToCart(productId) {
      const product = products.find(p => p.id === productId);
      if (product.stock === 0) {
        alert('Produto esgotado!');
        return;
      }
      const cartItem = cart.find(item => item.id === productId);
      if (cartItem) {
        cartItem.quantity++;
      } else {
        cart.push({ ...product, quantity: 1 });
      }
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCart();
      alert('Adicionado ao carrinho!');
    }

    // Remove from cart
    function removeFromCart(productId) {
      cart = cart.filter(item => item.id !== productId);
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCart();
    }

    // Update cart display
    function updateCart() {
      const cartItems = document.getElementById('cartItems');
      const cartTotal = document.getElementById('cartTotal');
      const cartCount = document.getElementById('cartCount');
      cartItems.innerHTML = '';
      let total = 0;
      cart.forEach(item => {
        const itemTotal = item.price * item.quantity;
        total += itemTotal;
        cartItems.innerHTML += `
          <div class="flex justify-between mb-2">
            <span>${item.name} x${item.quantity}</span>
            <span>R$ ${(itemTotal).toFixed(2).replace('.', ',')}</span>
            <button onclick="removeFromCart(${item.id})" class="text-red-500">Remover</button>
          </div>
        `;
      });
      cartTotal.textContent = total.toFixed(2).replace('.', ',');
      cartCount.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
    }

    // Redirect to website with cart data
    function redirectToCheckout() {
      if (cart.length === 0) {
        alert('O carrinho está vazio!');
        return;
      }
      const cartData = cart.map(item => `${item.id}:${item.quantity}`).join(',');
      const checkoutUrl = `https://www.brankabeauty.com.br/checkout?cart=${encodeURIComponent(cartData)}`;
      window.location.href = checkoutUrl;
    }

    // Toggle cart modal
    document.getElementById('cartBtn').addEventListener('click', () => {
      document.getElementById('cartModal').classList.toggle('hidden');
    });

    document.getElementById('closeModal').addEventListener('click', () => {
      document.getElementById('cartModal').classList.add('hidden');
    });

    // Handle checkout redirect
    document.getElementById('checkoutBtn').addEventListener('click', redirectToCheckout);

    // Initial cart update
    updateCart();
  </script>
</body>
</html>